<?xml version="1.0" encoding="UTF-8"?>

<!--
  Description: logback-file.xml
  User: c332030
  Version 1.0
-->

<included>

  <!-- 输出到文件 常规 -->
  <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">

    <file>${logging.file.path}/${spring.application.name}/${logging.name.default}.log</file>

    <!-- 过滤低于此级别的记录 -->
    <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
      <level>${logging.level.root}</level>
    </filter>

    <encoder>
      <pattern>${logging.pattern}</pattern>
      <charset>${logging.charset}</charset>
    </encoder>

    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">

      <fileNamePattern>${logging.file.path}/${logging.name.default}-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>
      <maxHistory>${logging.file.max-history}</maxHistory>

      <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
        <maxFileSize>${logging.file.max-size}</maxFileSize>
      </timeBasedFileNamingAndTriggeringPolicy>

    </rollingPolicy>

  </appender>

  <!-- 异步日志 -->
  <appender name="FILE_ASYNC" class="ch.qos.logback.classic.AsyncAppender">
    <!-- 设置为不丢失日志,默认如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 -->
    <discardingThreshold >0</discardingThreshold>
    <!-- 更改默认的队列的深度,默认值为256 -->
    <queueSize>1000</queueSize>
    <appender-ref ref ="FILE"/>
  </appender>

  <root level="${logging.level.root}">
    <appender-ref ref="FILE_ASYNC"/>
  </root>

</included>
